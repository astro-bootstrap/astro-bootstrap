---
const { class: className, nav = false } = Astro.props;

export interface Props {
  class?: string;
  nav?: boolean;
}
const Tag = nav ? 'li' : 'div';
---

<Tag class:list={['dropdown', className, { 'nav-item': nav }]}>
  <slot />
</Tag>
<script>
  // the default bs behaviour is broken so this is a hack to get it working
  import Dropdown from 'bootstrap/js/dist/dropdown';
  const toggleList = document.querySelectorAll('.astro-bs.dropdown-toggle');
  toggleList.forEach((toggle) => {
    const dropdown = new Dropdown(toggle);
    // set attribute to keep an eye on the toggle state
    toggle.setAttribute('astro-bs-expanded', 'false');
    // toggle the menu open/closed and update the attribute
    toggle.addEventListener('click', function () {
      const expanded = toggle.getAttribute('astro-bs-expanded');
      if (expanded === 'true') {
        dropdown.hide();
        toggle.setAttribute('astro-bs-expanded', 'false');
      } else {
        dropdown.show();
        toggle.setAttribute('astro-bs-expanded', 'true');
      }
    });
  });
</script>
